---
id: 300
title: 'Zombie process!!! –ö–∞–∫–≤–æ –ø–æ –¥—è–≤–æ–ª–∏—Ç–µ&#8230;.'
date: 2013-12-07T02:35:02+00:00
author: panev
layout: post
guid: http://panevinfo.eu/blog//?p=300
permalink: '/%d0%ba%d0%b0%d0%ba-%d0%b4%d0%b0-%d1%83%d0%b1%d0%b8%d0%b5%d0%bc-%d0%b2%d1%81%d0%b8%d1%87%d0%ba%d0%b8-%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d0%b8-%d0%bf%d0%be-%d0%ba%d0%bb%d1%8e%d1%87%d0%be%d0%b2%d0%b0.html'
tie_views:
  - "195"
categories:
  - FreeBSD
  - Linux
---
<a href="http://en.wikipedia.org/wiki/Zombie_process" title="Zombie" target="_blank">–ó–æ–º–±–∏</a> –ø—Ä–æ—Ü–µ—Å–∏—Ç–µ —Å–∞ –∫–æ—Ñ—Ç–∏ —Ä–∞–±–æ—Ç–∞, —Å–∞–º–æ –∑–∞–µ–º–∞—Ç —Ä–µ—É—Å—Ä –æ—Ç –º–∞—à–∏–Ω–∫–∞—Ç–∞  
–ù–∞ –≤—Å–µ–∫–∏ —Å–µ –µ —Å–ª—É—á–≤–∞–ª–æ –∏–ª–∏ –∞–∫–æ –Ω–µ —â–µ –º—É —Å–µ —Å–ª—É—á–∏ –¥–∞ –º—É –∑–∞–≤–∏—Å–Ω–µ –ø—Ä–æ—Ü–µ—Å (–Ω–∞—Ä–µ—á–µ–Ω –æ—â–µ zombie) —á—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–∞—Ç–∞ **top** –º–æ–∂–µ –¥–∞ –≤–∏–¥–∏–º –¥–∞–ª–∏ –∏–º–∞–º–µ —Ç–∞–∫–∏–≤–∞ –ø—Ä–æ—Ü–µ—Å–∏ –∏ –∫–æ–ª–∫–æ —Å–∞ —Ç–µ:

<pre>top
</pre>

<!--more-->

–ü—Ä–∏–º–µ—Ä:

<pre>top - 19:44:36 up 5 days, 15:16,  2 users,  load average: 0.00, 0.02, 0.00
Tasks: 196 total,   1 running, 195 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.1%us,  0.1%sy,  0.0%ni, 99.7%id,  0.1%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:   4826536k total,  2355544k used,  2470992k free,   150336k buffers
Swap: 12582904k total,        0k used, 12582904k free,  1784852k cached

</pre>

–ù–∞ –≤—Ç–æ—Ä–∏—è—Ç —Ä–µ–¥ —Å–µ –≤–∏–∂–¥–∞, —á–µ –≤ —Å–ª—É—á–∞—è –∏–º–∞–º–µ 0 zombi (–∑–∞–≤–∏—Å–Ω–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å–∏). –ê–∫–æ —Å–µ –ø–æ—è–≤–∏ —Ç–∞–∫—ä–≤ –ø—Ä–æ—Ü–µ—Å —Ç–æ–π —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ kill-–Ω–∞—Ç –∑–∞—â–æ—Ç–æ —Ç–æ–≤–∞—Ä–∏ —Å–∞–º–æ –º–∞—à–∏–Ω–∞—Ç–∞ –∏–∑–ª–∏—à–Ω–æ. –¢–æ–≤–∞ –º–æ–∂–µ –¥–∞ —Å—Ç–∞–Ω–µ –ø–æ —Å–ª–µ–¥–Ω–∏—è—Ç –Ω–∞—á–∏–Ω –∏–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ –µ–¥–Ω–∞ –æ—Ç –¥–≤–µ—Ç–µ –∫–æ–º–∞–Ω–¥–∏ :

<pre>ps -elf | grep Z
</pre>

–∏–ª–∏ 

<pre>ps aux | awk '{ print $8 " " $2 }' | grep -w Z
</pre>

–°–ª–µ–¥ –∫–æ–µ—Ç–æ –ø—Ä–æ—Å—Ç–æ kill-–≤–∞–º–µ –ø—Ä–æ—Ü–µ—Å–∏—Ç–µ –ø–æ **PID**üôÇ –∏–ª–∏ –ø–æ –∏–º–µ—Ç–æ –Ω–∞ –ø—Ä–æ—Ü–µ—Å–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ :

<pre>ps aux | grep httpd | kill `awk '{print $2}'`

</pre>

–í—ä–ø—Ä–æ—Å–Ω–∞—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –æ–±–∏–∫–∞–ª—è –¥—ä—Ä–≤–æ—Ç–æ —Å –ø—Ä–æ—Ü–µ—Å–∏—Ç–µ –∏ –Ω–∞–≤—Å—è–∫—ä–¥–µ –∫—ä–¥–µ—Ç–æ —Å—Ä–µ—â–Ω–µ –¥—É–º–∞—Ç–∞ ‚Äúhttpd‚Äù kill-–≤–∞ –ø—Ä–æ—Ü–µ—Å–∞.

–ï—Ç–æ –∏ –µ–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –∑–∞ kill-–≤–∞–Ω–µ—Ç–æ –Ω–∞ –≤—Å–∏—á–∫–∏ –∑–æ–º–±–∏ –ø—Ä–æ—Ü–µ—Å–∏ (copy/paste) üôÇ

<pre>#!/bin/bash
##################################################################
# Script: Zombie Slayer
# Author: Mitch Milner
# Date:   03/13/2013 ---> A good day to slay zombies
#
# Requirements: yum install gdb
#               permissions to attach to the parent process
#
# This script works by using a debugger to
# attach to the parent process and then issuing
# a waitpid to the dead zombie. This will not kill
# the living parent process.
##################################################################

clear
# Wait for user input to proceed, give user a chance to cancel script
echo "***********************************************************"
echo -e "This script will terminate all zombie process."
echo -e "Press [ENTER] to continue or [CTRL] + C to cancel:"
echo "***********************************************************"
read cmd_string
echo -e "\n"

# initialize variables
intcount=0
lastparentid=0

# remove old gdb command file
rm -f /tmp/zombie_slayer.txt

# create the gdb command file
echo "***********************************************************"
echo "Creating command file..."
echo "***********************************************************"
ps -e -o ppid,pid,stat,command | grep Z | sort | while read LINE; do
  intcount=$((intcount+1))
  parentid=`echo $LINE | awk '{print $1}'`
  zombieid=`echo $LINE | awk '{print $2}'`
  verifyzombie=`echo $LINE | awk '{print $3}'`

  # make sure this is a zombie file and we are not getting a Z from
  # the command field of the ps -e -o ppid,pid,stat,command
  if [ "$verifyzombie" == "Z" ]
  then
    if [ "$parentid" != "$lastparentid" ]
    then
      if [ "$lastparentid" != "0" ]
      then
        echo "detach" >> /tmp/zombie_slayer.txt
      fi
    echo "attach $parentid" >> /tmp/zombie_slayer.txt
    fi
    echo "call waitpid ($zombieid,0,0)" >> /tmp/zombie_slayer.txt
    echo "Logging: Parent: $parentid  Zombie: $zombieid"
    lastparentid=$parentid
  fi
done
if [ "$lastparentid" != "0" ]
then
  echo "detach" >> /tmp/zombie_slayer.txt
fi

# Slay the zombies with gdb and the created command file
echo -e "\n\n"
echo "***********************************************************"
echo "Slaying zombie processes..."
echo "***********************************************************"
gdb -batch -x /tmp/zombie_slayer.txt
echo -e "\n\n"
echo "***********************************************************"
echo "Script complete."
echo "***********************************************************"

</pre>