---
id: 291
title: Защита от DoS атака с iptables
date: 2013-12-07T01:50:23+00:00
author: panev
layout: post
guid: http://panevinfo.eu/blog//?p=291
permalink: '/%d0%b7%d0%b0%d1%89%d0%b8%d1%82%d0%b0-%d0%be%d1%82-dos-%d0%b0%d1%82%d0%b0%d0%ba%d0%b0-%d1%81-iptables.html'
tie_views:
  - "178"
categories:
  - Linux
---
Ако се съмнявате в DoS атака ползвайте следната команда :

<pre>netstat -alpn| grep ":80"| awk '{ print $5 }'| cut -d: -f4| sort| uniq -c | sort -n

</pre>

Примерен изходен вариант:

<pre>┌(eragon)─(0)─(01:54 AM Sat Dec 07)
└─(~)─(15 files, 972Kb)─> netstat -alpn| grep ":80"| awk '{ print $5 }'| cut -d: -f4| sort| uniq -c | sort -n
      1 *
     19 10.10.10.10

</pre>

По-долните два реда са примерни, може да се променят според вашите нужди.

<pre>iptables -I INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --set
iptables -I INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --update --seconds 60 --hitcount 20 -j DROP
</pre>

Имайте в предвид, че максималните стойности за **–seconds** са **60**, а за **–hitcount** са **20**.  
Със следният ред

<pre>iptables -L INPUT -n --line-numbers</pre>

лисваме всички правила в iptables:

<pre>┌(eragon)─(0)─(01:44 AM Sat Dec 07)
└─(~)─(15 files, 972Kb)─> iptables -L INPUT -n --line-numbers
Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination
1    DROP       tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:80 state NEW recent: UPDATE seconds: 60 hit_count: 20 name: DEFAULT side: source
2               tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:80 state NEW recent: SET name: DEFAULT side: source
3    fail2ban-SSH  tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:22

</pre>

За да изтрием правилото за блокиране на IP-тата в този случай пишем:

<pre>iptables -D INPUT 1

</pre>

Тука 1 (едно) след **INPUT** е номера на правилото показано по-горе.